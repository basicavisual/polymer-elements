<!--
@group Polymer My Elements
@element raphaeljsbars-element
@author chuycepeda@gmail.com
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<script src="raphael.js"></script>
<script src="g.raphael.js"></script>
<script src="g.bar.js"></script>

<polymer-element name="raphaeljsbars-element" attributes="__values __title __stacked __orientation __type __prefix __suffix __joinTooltip __colors __width __height __proportion" >
    <template>
        <div id="holder" style="margin-top:40px; width:100%; height: 60%;"></div>
    </template>
<script>
    (function() {
        Polymer('raphaeljsbars-element', {
          __values: [[40, 26, 5]], //be like:  [[55, 20, 13, 32, 5, 1, 2, 10], [10, 2, 1, 5, 32, 13, 20, 55]]
          __title: "Simple bars chart",
          __stacked: false,
          __joinTooltip: false,
          __type: "square", //type may be "round", "sharp", "soft" or "square"
          __orientation: "vertical", //orientation may be 'horizontal' or 'vertical'
          __prefix: "",
          __suffix: "",
          __colors: ["blue","lightgreen","red"],
          __width: 300,
          __height: 220,
          __proportion: 1,
          ready: function() {
            if (this.__width > window.innerWidth) this.__width = window.innerWidth*0.8;
            this.loadChart();
          },
          loadChart: function(){
              this.$.holder.innerHTML ="";
              var r = Raphael(this.$.holder, parseInt(this.__width*1.2), parseInt(this.__height*1.3));
              this.loadData(r);
          },
          loadData: function(r){
                var prefix = this.__prefix, suffix = this.__suffix;
              
                var fin = function () { 
                            this.flag = r.popup(this.bar.x, this.bar.y, prefix + this.bar.value.toString() + suffix || "0").insertBefore(this);
                    },
                    fout = function () {
                        this.flag.animate({opacity: 0}, 300, function () {this.remove();});
                    },
                    fin2 = function () {
                        var y = [], res = [];
                        for (var i = this.bars.length; i--;) {
                            y.push(this.bars[i].y);
                            res.push(prefix + this.bars[i].value.toString() + suffix || "0");
                        }
                        this.flag = r.popup(this.bars[0].x, Math.min.apply(Math, y), res.join(", ")).insertBefore(this);
                    },
                    fout2 = function () {
                        this.flag.animate({opacity: 0}, 300, function () {this.remove();});
                    },
                    txtattr = { font: "12px roboto" };
              
                //Chart title
                r.text(this.__width/2, 10, this.__title).attr(txtattr);
              
                //Chart data
                if (this.__orientation == 'vertical'){
                  if (this.__values.length > 1)
                    if (this.__joinTooltip)
                        r.barchart(10, 25, this.__width, this.__height, this.__values, {stacked: this.__stacked, type: this.__type, colors: this.__colors}).hoverColumn(fin2, fout2);
                    else
                        r.barchart(10, 25, this.__width, this.__height, this.__values, {stacked: this.__stacked, type: this.__type, colors: this.__colors}).hover(fin, fout);
                  else 
                    r.barchart(10, 25, this.__width, this.__height, this.__values, {stacked: this.__stacked, type: this.__type, colors: this.__colors}).hover(fin, fout);              
                }else {
                  if (this.__values.length > 1)
                    if (this.__joinTooltip)
                        r.hbarchart(10, 25, this.__width, this.__height, this.__values, {stacked: this.__stacked, type: this.__type, colors: this.__colors}).hoverColumn(fin2, fout2);
                    else
                        r.hbarchart(10, 25, this.__width, this.__height, this.__values, {stacked: this.__stacked, type: this.__type, colors: this.__colors}).hover(fin, fout);
                  else 
                    r.hbarchart(10, 25, this.__width, this.__height, this.__values, {stacked: this.__stacked, type: this.__type, colors: this.__colors}).hover(fin, fout);
                }
              
          },
          __proportionChanged: function(){ 
              this.__width = window.innerWidth*0.8;
              if (this.__width > 1280) this.__width = 1280; 
              if (this.__width < 300) this.__width = 300; 
              this.loadChart();}
        });
        })();
  
</script>
</polymer-element>
